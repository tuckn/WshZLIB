!function(){var util,sh,path,os,fs,child_process,insp,obtain,isSameStr,hasIn,isSolidArray,isSolidString,NETSH_EXE,execFile,execSync,execFileSync,net,MODULE_TITLE,throwErrNonStr;Wsh&&Wsh.Net||(Wsh.Net={},util=Wsh.Util,sh=Wsh.Shell,path=Wsh.Path,os=Wsh.OS,fs=Wsh.FileSystem,child_process=Wsh.ChildProcess,insp=util.inspect,obtain=util.obtainPropVal,isSameStr=util.isSameMeaning,hasIn=util.hasIn,isSolidArray=util.isSolidArray,isSolidString=util.isSolidString,NETSH_EXE=os.exefiles.netsh,execFile=child_process.execFile,execSync=child_process.execSync,execFileSync=child_process.execFileSync,net=Wsh.Net,MODULE_TITLE="WshNet/Net.js",throwErrNonStr=function(functionName,typeErrVal){util.throwTypeError("string",MODULE_TITLE,functionName,typeErrVal)},net.respondsHost=function(host){isSolidString(host)||throwErrNonStr("net.respondsHost",host);var retObj=execSync('"'+os.exefiles.ping+'" '+host);return!!/(time|時間 )[=<]\d+ms/.test(retObj.stdout)},net.showIpConfigAll=function(){execFile("ipconfig",["/all"],{shell:!0,closes:!1})},net.getAdaptersPropsSWbemObjs=function(macAddress,options){var query="SELECT * FROM Win32_NetworkAdapter WHERE PhysicalAdapter = True";isSolidString(macAddress)&&"*"!==macAddress?query+=' AND MACAddress = "'+macAddress+'"':(isSolidString(macAddress)||(query+=" AND NOT MACAddress = null"),obtain(options,"excludesVirtual",!0)&&(query+=' AND NOT Description LIKE "%virtual%"'),obtain(options,"excludesWireless",!1)&&(query+=' AND NOT Description LIKE "%wireless%"'));var sWbemObjSets=os.WMI.execQuery(query);return null===obtain(options,"isConnecting",null)?sWbemObjSets:sWbemObjSets.filter(function(sWbemObjSet){try{return 0<=sWbemObjSet.NetConnectionStatus&&sWbemObjSet.NetConnectionStatus<=3}catch(e){return!1}})},net.getAdaptersPropsObjs=function(macAddress,options){var sWbemObjSets=net.getAdaptersPropsSWbemObjs(macAddress,options);return os.WMI.toJsObjects(sWbemObjSets)},net.enablesDHCP=function(macAddress,options){isSolidString(macAddress)||throwErrNonStr("net.enablesDHCP",macAddress);var adapters=net.getAdaptersPropsObjs(macAddress,options),adapterObjs=os.WMI.toJsObjects(adapters);if(!isSolidArray(adapterObjs))return!1;var adapterGUID=adapterObjs[0].GUID;return 1===sh.RegRead("HKEY_LOCAL_MACHINE\\SYSTEM\\ControlSet001\\services\\Tcpip\\Parameters\\Interfaces\\"+adapterGUID+"\\EnableDHCP")},net.getAdaptersConfsSWbemObjs=function(macAddress,options){var query='SELECT * FROM Win32_NetworkAdapterConfiguration WHERE NOT Description LIKE "RAS Async Adapter"';return isSolidString(macAddress)&&"*"!==macAddress?query+=' AND MACAddress = "'+macAddress+'"':query+=" AND NOT MACAddress = null",obtain(options,"excludesVirtual",!0)&&(query+=' AND NOT Description LIKE "%virtual%"'),obtain(options,"excludesWireless",!1)&&(query+=' AND NOT Description LIKE "%wireless%"'),os.WMI.execQuery(query)},net.getAdaptersConfsObjs=function(macAddress,options){var sWbemObjSets=net.getAdaptersConfsSWbemObjs(macAddress,options);return os.WMI.toJsObjects(sWbemObjSets)},net.getIpSetInAdapters=function(macAddress,options){var adapters=net.getAdaptersConfsObjs(macAddress,options),adapterObjs=os.WMI.toJsObjects(adapters),ipVer=obtain(options,"ipVer","IPv4"),iIpVer=isSameStr(ipVer,"IPv6")?1:0,rtnIPs=[];return adapterObjs.forEach(function(adapter){hasIn(adapter,"IPAddress")&&null!==adapter.IPAddress&&rtnIPs.push(adapter.IPAddress[iIpVer].toString())}),rtnIPs},net.getDefaultGateways=function(macAddress,options){var adapters=net.getAdaptersConfsObjs(macAddress,options),adapterObjs=os.WMI.toJsObjects(adapters),rtnIPs=[];return adapterObjs.forEach(function(adapter){hasIn(adapter,"DefaultIPGateway")&&null!==adapter.DefaultIPGateway&&rtnIPs.push(adapter.DefaultIPGateway.toString())}),rtnIPs},net.getDnsIPsSetInAdapters=function(macAddress,options){var adapters=net.getAdaptersPropsObjs(macAddress,options);if(!isSolidArray(adapters))return[];var adapterGUID=adapters[0].GUID;return sh.RegRead("HKEY_LOCAL_MACHINE\\SYSTEM\\ControlSet001\\services\\Tcpip\\Parameters\\Interfaces\\"+adapterGUID+"\\NameServer").split(",")},net.exportWinFirewallSettings=function(destPath,options){isSolidString(destPath)||throwErrNonStr("net.exportWinFirewallSettings",destPath);var args=["advfirewall","export",path.resolve(destPath)],isDryRun=obtain(options,"isDryRun",!1);return execFileSync(NETSH_EXE,args,{runsAdmin:!0,winStyle:"hidden",isDryRun:isDryRun})},net.setIpAddress=function(netName,ip,mask,defGw,options){isSolidString(netName)||throwErrNonStr("net.setIpAddress",netName);var args=["interface ipv4","set address",'name="'+netName+'"'];isSolidString(ip)?(args.push("source=static address="+ip),isSolidString(mask)?args.push("mask="+mask):args.push("mask=255.255.255.0"),isSolidString(defGw)&&args.push("gateway="+defGw,"gwmetric=1")):args.push("source=dhcp");var isDryRun=obtain(options,"isDryRun",!1);return execFileSync(NETSH_EXE,args,{winStyle:"hidden",isDryRun:isDryRun})},net.setIpAddressesWithWMI=function(netName,ip,mask,defGw){var FN="net.setIpAddressesWithWMI";isSolidString(netName)||(netName=net.getAdaptersPropsObjs()[0].NetConnectionID);var query="SELECT * FROM Win32_NetworkAdapterConfiguration WHERE Index = "+netName,wmiObjs=os.WMI.execQuery(query);if(0===wmiObjs.length)throw new Error("Error [EmptyWMI Object Return]\n  at "+FN+" ("+MODULE_TITLE+")\n  query: "+insp(query));if(wmiObjs[0].DHCPEnabled?console.log(FN+": already DCHP."):rtnCode=wmiObjs[0].EnableDHCP(),!isSolidString(ip))return isSolidString(defGw)&&(rtnCode=wmiObjs[0].SetGateways([defGw])),!0;var newMask=isSolidString(mask)?mask:"255.255.255.0",rtnCode=wmiObjs[0].EnableStatic([ip],[newMask]);if(0===rtnCode)return isSolidString(defGw)&&(rtnCode=wmiObjs[0].SetGateways([defGw])),!0;if(1===rtnCode)return console.log(FN+":\n  Successful completion, reboot required."),isSolidString(defGw)&&(rtnCode=wmiObjs[0].SetGateways([defGw])),!0;if(-66===rtnCode)throw new Error("Error [Invalid SubnetMask]\n  at "+FN+" ("+MODULE_TITLE+")\n  newMask: "+insp(newMask));if(-2147180508===rtnCode)throw new Error("Error [WindowOfNetConfig]\n  at "+FN+" ("+MODULE_TITLE+")\n  ネットワーク設定画面を閉じて再試行してください。");throw new Error("Error [Not Code 0]\n  at "+FN+" ("+MODULE_TITLE+")\n  rtnCode: "+rtnCode)},net.setDnsServers=function(netName,dns1,dns2,options){var FN="net.setDnsServers";isSolidString(netName)||throwErrNonStr(FN,netName);var args1=["interface ipv4","set dnsservers",'name="'+netName+'"'];isSolidString(dns1)?args1.push("source=static","address="+dns1,"register=non","validate=no"):args1.push("source=dhcp");var isDryRun=obtain(options,"isDryRun",!1),rtnVal1=execFileSync(NETSH_EXE,args1,{winStyle:"hidden",isDryRun:isDryRun});if(!isDryRun&&rtnVal1.error)throw new Error("Error: [StdErrNotEmpty]\n  at "+FN+" ("+MODULE_TITLE+')\n  exefile: "'+NETSH_EXE+'"\n  args: '+insp(args1)+"\n  rtnVal: "+insp(rtnVal1));if(!isSolidString(dns2))return isDryRun?"dry-run ["+FN+"]: "+rtnVal1:void 0;var args2=["interface ipv4","add dnsservers",'name="'+netName+'"',"address="+dns2,"index=2","validate=no"],rtnVal2=execFileSync(NETSH_EXE,args2,{winStyle:"hidden",isDryRun:isDryRun});if(isDryRun)return"dry-run ["+FN+"]: "+rtnVal1+"\n"+rtnVal2;if(rtnVal2.error)throw new Error("Error: [StdErrNotEmpty]\n  at "+FN+" ("+MODULE_TITLE+')\n  exefile: "'+NETSH_EXE+'"\n  args: '+insp(args2)+"\n  rtnVal: "+insp(rtnVal2))},net.setDnsServersWithWMI=function(netadpIndex,dnsAdds){var FN="net.setDnsServersWithWMI",query="SELECT * FROM Win32_NetworkAdapterConfiguration WHERE IPEnabled = True AND Index = "+netadpIndex,wmiObjs=os.WMI.execQuery(query);if(0===wmiObjs.length)throw new Error("Error [EmptyWMI Object Return]\n  at "+FN+" ("+MODULE_TITLE+")\n  query: "+insp(query));var rtnCode=wmiObjs[0].SetDNSServerSearchOrder(dnsAdds);if(0===rtnCode)return!0;if(1===rtnCode)return console.log(FN+":\n  Successful completion, reboot required."),!0;if(-2147180508===rtnCode)throw new Error("Error [WindowOfNetConfig]\n  at "+FN+" ("+MODULE_TITLE+")\n  ネットワーク設定画面を閉じて再試行してください。");throw new Error("Error [Failed to set SetDNSServerSearchOrder]\n  at "+FN+" ("+MODULE_TITLE+")\n  rtnCode: "+insp(rtnCode))},net.importWinFirewallSettings=function(srcPath,options){var FN="net.importWinFirewallSettings";isSolidString(srcPath)||throwErrNonStr(FN,srcPath);var functionName,typeErrVal,pathToImport=path.resolve(srcPath);fs.statSync(pathToImport).isFile()||(functionName=FN,typeErrVal=pathToImport,fs.throwTypeErrorNonExisting(MODULE_TITLE,functionName,typeErrVal));var args=["advfirewall","import",pathToImport],isDryRun=obtain(options,"isDryRun",!1);return execFileSync(NETSH_EXE,args,{runsAdmin:!0,winStyle:"hidden",isDryRun:isDryRun})})}();
!function(){var util,os,fs,child_process,net,insp,obtain,isSolidArray,isSolidString,isSameMeaning,NET,srrPath,execFile,execFileSync,throwErrNonStr;Wsh&&Wsh.Net.SMB||(Wsh.Net.SMB={},util=Wsh.Util,os=Wsh.OS,fs=Wsh.FileSystem,child_process=Wsh.ChildProcess,net=Wsh.Net,insp=util.inspect,obtain=util.obtainPropVal,isSolidArray=util.isSolidArray,isSolidString=util.isSolidString,isSameMeaning=util.isSameMeaning,NET=os.exefiles.net,srrPath=os.surroundPath,execFile=child_process.execFile,execFileSync=child_process.execFileSync,throwErrNonStr=function(functionName,typeErrVal){util.throwTypeError("string","WshNet/SMB.js",functionName,typeErrVal)},net.SMB.IPC="IPC$",net.SMB.shareDirectory=function(shareName,dirPath,options){var functionName,typeErrVal,FN="net.SMB.shareDirectory";isSolidString(shareName)||throwErrNonStr(FN,shareName),isSolidString(dirPath)||throwErrNonStr(FN,dirPath),fs.statSync(dirPath).isDirectory()||(functionName=FN,typeErrVal=dirPath,fs.throwTypeErrorNonExisting("WshNet/SMB.js",functionName,typeErrVal));var args=["share",srrPath(shareName)+"="+srrPath(dirPath)],userName=obtain(options,"userName","Everyone"),grant=obtain(options,"grant","READ");isSolidString(userName)&&isSolidString(grant)&&args.push("/GRANT:"+userName+","+grant);var remark=obtain(options,"remark","");isSolidString(remark)&&args.push("/REMARK:"+remark);var isDryRun=obtain(options,"isDryRun",!1);return execFileSync(NET,args,{runsAdmin:!0,winStyle:"hidden",isDryRun:isDryRun})},net.SMB.showLocalShares=function(){execFile(NET,["share"],{shell:!0,closes:!1})},net.SMB.getLocalSharesSWbemObjs=function(){return os.WMI.execQuery("SELECT * FROM Win32_Share")},net.SMB.getLocalSharesObjs=function(){var sWbemObjSets=net.SMB.getLocalSharesSWbemObjs();return os.WMI.toJsObjects(sWbemObjSets)},net.SMB.existsShareName=function(shareName){return isSolidString(shareName)||throwErrNonStr("net.SMB.existsShareName",shareName),net.SMB.getLocalSharesObjs().some(function(shareObj){return isSameMeaning(shareObj.Name,shareName)})},net.SMB.delSharedDirectory=function(shareName,options){isSolidString(shareName)||throwErrNonStr("net.SMB.delSharedDirectory",shareName);var args=["share",shareName,"/DELETE","/YES"],isDryRun=obtain(options,"isDryRun",!1);return execFileSync(NET,args,{runsAdmin:!0,winStyle:"hidden",isDryRun:isDryRun})},net.SMB._getNetUseArgsToConnect=function(comp,shareName,domain,user,pwd){isSolidString(comp)||throwErrNonStr("net.SMB._getNetUseArgsToConnect",comp);var args=["use"];return isSolidString(shareName)?args.push("\\\\"+comp+"\\"+shareName):args.push("\\\\"+comp+"\\"+net.SMB.IPC),isSolidString(pwd)&&args.push(pwd),isSolidString(user)&&(isSolidString(domain)?args.push("/user:"+domain+"\\"+user):args.push("/user:"+user)),args.push("/persistent:no"),args},net.SMB.connect=function(comp,shareName,domain,user,pwd,options){var args=net.SMB._getNetUseArgsToConnect(comp,shareName,domain,user,pwd),isDryRun=obtain(options,"isDryRun",!1);return execFile(NET,args,{winStyle:"hidden",isDryRun:isDryRun})},net.SMB.connectSync=function(comp,shareName,domain,user,pwd,options){var args=net.SMB._getNetUseArgsToConnect(comp,shareName,domain,user,pwd),isDryRun=obtain(options,"isDryRun",!1);return execFileSync(NET,args,{winStyle:"hidden",isDryRun:isDryRun})},net.SMB.showCurrentSession=function(){execFile(NET,["use"],{shell:!0,closes:!1})},net.SMB.getActiveConnectionsSwbemObjs=function(matched){var sWbemObjSets=os.WMI.execQuery("SELECT * FROM Win32_NetworkConnection");if(!isSolidString(matched))return sWbemObjSets;var matchedRE=new RegExp(matched,"i");return sWbemObjSets.filter(function(sWbemObjSet){return matchedRE.test(sWbemObjSet.Name)})},net.SMB.getActiveConnectionsObjs=function(matched){var sWbemObjSets=net.SMB.getActiveConnectionsSwbemObjs(matched);return os.WMI.toJsObjects(sWbemObjSets)},net.SMB.hasConnection=function(connectionName){isSolidString(connectionName)||throwErrNonStr("net.SMB.hasConnection",connectionName);var connections=net.SMB.getActiveConnectionsObjs();return!!isSolidArray(connections)&&connections.some(function(connection){return connection.Name===connectionName&&/^(OK|Degraded)$/i.test(connection.Status)})},net.SMB._getNetUseArgsToDisconnect=function(comp,shareName){var args=["use"];return isSolidString(comp)?isSolidString(shareName)?args.push("\\\\"+comp+"\\"+shareName):args.push("\\\\"+comp):args.push("*"),args.push("/delete"),args.push("/yes"),args},net.SMB.disconnect=function(comp,shareName,options){var args=net.SMB._getNetUseArgsToDisconnect(comp,shareName),isDryRun=obtain(options,"isDryRun",!1);return execFile(NET,args,{winStyle:"hidden",isDryRun:isDryRun})},net.SMB.disconnectSync=function(comp,shareName,options){var args=net.SMB._getNetUseArgsToDisconnect(comp,shareName),isDryRun=obtain(options,"isDryRun",!1),rtnVal=execFileSync(NET,args,{winStyle:"hidden",isDryRun:isDryRun});return isDryRun?"dry-run [net.SMB.disconnectSync]: "+rtnVal:(/NET HELPMSG 2250/i.test(rtnVal.stderr)&&(rtnVal.error=!1),rtnVal)},net.SMB.connectSyncSurely=function(comp,shareName,domain,user,pwd,options){var FN="net.SMB.connectSyncSurely";isSolidString(comp)||throwErrNonStr(FN,comp);var remotePath="\\\\"+comp;if(isSolidString(shareName)?remotePath+="\\"+shareName:remotePath+="\\"+net.SMB.IPC,!net.SMB.hasConnection(remotePath)){var isDryRun=obtain(options,"isDryRun",!1),retLog="",retVal=net.SMB.disconnectSync(comp,shareName,options);if(isDryRun&&(retLog="dry-run ["+FN+"]: "+retVal),retVal=net.SMB.connectSync(comp,shareName,domain,user,pwd,options),isDryRun)return retLog+"\n"+retVal;if(retVal.error){if(/1219/.test(retVal.stderr)&&net.SMB.disconnectSync(comp,shareName)&&!(retVal=net.SMB.connectSync(comp,shareName,domain,user,pwd)).error)return;throw new Error("Error [ExitCode Not 0]\n  at "+FN+" (WshNet/SMB.js)\n  comp: "+comp+"\n  shareName: "+shareName+"\n  domain: "+domain+"\n  user: "+user+"\n  retVal: "+insp(retVal))}}})}();
